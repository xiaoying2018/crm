<include file="Public:header" />
<style>
.group_item {
    margin: 5px 0;
}

.title-bar {
    padding: 0 15px;
    background: none;
    border: none;
}

#title-show {
    padding-top: 10px;
    background: #fff;
}

td {
    background-color: #f9fafc;
    padding: 14px;
    color: #999;
    text-align: center;
    color: #666;
    border-right: 1px solid #e7eaec;
}

td a {
    color: #5C8FFC !important;
}
</style>
<script src="__PUBLIC__/js/PCASClass.js" type="text/javascript"></script>
<div class="wrapper wrapper-content animated fadeIn templete_Detail">
    <div class="row">
        <div class="title-bar col-lg-12">
            <div id="title-show" class="clearfix">
                <ul class="nav pull-left" style="margin:0px 10px 0px 20px;">
                    <span>
                    <img src="/Public/img/contract_view_icon.png" style="margin-bottom:9px;" alt="">
                </span>
                    <span style="font-size:21px;margin-left:5px">&nbsp;&nbsp;&nbsp;{{detail.name}}</span>&nbsp;&nbsp;
                </ul>
                <!--<a href="javascript:void(0);" style="margin-right:15px;" class="btn btn-primary pull-right">修改</a> </div>-->
        </div>
            <div style="margin-top: 10px;">
            <div class="tabs-container">
                <div style="padding: 20px 20px; background: rgb(255, 255, 255); min-height: 492.48px;" id="left-content">
                    <ul class="nav nav-tabs" id="left_list" style="height:40px;">
                        <li><a href="#tab1" data-toggle="tab" type="tab1">班级信息</a></li>
                        <li><a href="#tab5" data-toggle="tab" type="tab5">班级详情</a></li>
                        <li><a href="#tab6" data-toggle="tab" type="tab6">包含课程</a></li>
                        <!--<li><a href="#tab2" data-toggle="tab" type="tab2">课时信息({{count.section}})</a></li>-->
                        <li><a href="#tab3" data-toggle="tab" type="tab3">开班班次({{count.period}})</a></li>
                        <li><a href="#tab4" data-toggle="tab" type="tab4">所属产品-班级({{count.product}})</a></li>

                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane" id="tab1">
                            <div class="panel-body">
                                <div class="form-horizontal view-group ">
                                    <div class="form-group">
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">班级名称</label>
                                            <div class="col-lg-4">
                                                <p>{{detail.name}}</p>
                                            </div>
                                        </div>
                                        <!--<div class="clearfix group_item col-lg-6">-->
                                            <!--<label class="col-lg-2">课时数</label>-->
                                            <!--<div class="col-lg-4">-->
                                                <!--<p>{{detail.section_total}}</p>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <!--<div class="clearfix group_item col-lg-6">-->
                                            <!--<label class="col-lg-2">总课时</label>-->
                                            <!--<div class="col-lg-4">-->
                                                <!--<p>{{detail.time_long}}</p>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">成员类型</label>
                                            <div class="col-lg-4">
                                                <p v-if="detail.member_type == 1">一对多</p>
                                                <p v-else>一对一</p>
                                            </div>
                                        </div>
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">添加人</label>
                                            <div class="col-lg-4">
                                                <p>{{detail.creator_name}}</p>
                                            </div>
                                        </div>
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">添加时间</label>
                                            <div class="col-lg-4">
                                                <p>{{detail.create_at}}</p>
                                            </div>
                                        </div>
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">修改人</label>
                                            <div class="col-lg-4">
                                                <p>{{detail.updator_name}}</p>
                                            </div>
                                        </div>
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">修改时间</label>
                                            <div class="col-lg-4">
                                                <p>{{detail.update_at}}</p>
                                            </div>
                                        </div>
                                        <div class="clearfix group_item col-lg-6">
                                            <label class="col-lg-2">班级图片</label>
                                            <div class="col-lg-4">
                                                <p v-if="detail.pic"><img :src="detail.pic" alt=""></p>
                                                <p v-else>无图片</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab5">
                            <div class="panel-body">
                                <div class="form-horizontal view-group ">
                                    <div class="form-group">
                                        <div class="group_item col-lg-12" id="temp_detail"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab2">
                            <div class="panel-body">
                                <a href="javascript:;" onclick="showSectionAdd()" class="btn btn-primary btn-sm addsection" style="margin-bottom:15px;">
                                    <i class="fa fa-plus-circle"></i>&nbsp; 添加课时
                                </a>
                                <table class="table select-table table-bordered">
                                    <thead>
                                        <tr style="background-color:#f9fafc;text-align:center;">
                                            <td style="">课时名称</td>
                                            <td style="">所属课程</td>
                                            <td style="">课时编号</td>
                                            <td style="">课时标题</td>
                                            <td style="">课时时长</td>
                                            <td style="">课时视频</td>
                                            <td style="">创建人</td>
                                            <td style="">创建时间</td>
                                            <td style="">操作</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="s in sections" :data-id="s.id">
                                            <td style="">
                                                <a href="javascript:;">
                                                {{s.name}}
                                            </a>
                                            </td>
                                            <td style="">{{s.cate_name}}</td>
                                            <td style="">{{s.node}}</td>
                                            <td style="">{{s.title}}</td>
                                            <td style="">{{s.duration}}</td>
                                            <!--<td style=""><a v-if="s.video_path != null " :href="s.video_path" target="_blank">试播</a> </td>-->
                                            <td style=""><a v-if="s.video_path != null " :href="s._video_path" target="_blank">试播</a> </td>
                                            <td style="">{{s.creator_name}}</td>
                                            <td style="">{{s.create_at}}</td>
                                            <td style="text-align:center;padding:14px;color:#666;">
                                                <div style=" position: relative;">
                                                    <button class="btn btn-success fileinput-button" type="file" >视频上传</button>
                                                    <input type="file"   :data-id="s.id" onchange="loadFile(this,this.files[0],3)" style="width: 84px;display: inline-block;opacity: 0;left: 50%;position: absolute;top: 0;margin-left: -98px;" class="btn btn-success fileinput-button" value="视频上传" >
                                                    <button class="btn btn-danger btn-sm" @click="section_del($event)">删除</button>
                                                    <button class="btn btn-info btn-sm" onclick="showSectionEdit(this)">修改</button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab3">
                            <div class="panel-body">
                                <a href="javascript:;" onclick="showPeriodAdd()" class="btn btn-primary btn-sm" style="margin-bottom:15px;">
                                    <i class="fa fa-plus-circle"></i>&nbsp; 新建班次(开班)
                                </a>
                                <table class="table select-table table-bordered">
                                    <thead>
                                        <tr style="background-color:#f9fafc;text-align:center;">
                                            <td style="">班次名称</td>
                                            <td style="">班次周期</td>
                                            <td style="">班次总时长</td>
                                            <td style="">班主任</td>
                                            <td style="">操作</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="p in periods" :data-id="p.id">
                                            <td style="">
                                                <!-- <a href="/index.php?m=Apply&a=adddd"> -->
                                                {{ p.period_name }}
                                                <!-- </a> -->
                                            </td>
                                            <td style="">{{p.start_day}}-{{p.end_day}}（{{p.cycle}}天）</td>
                                            <td style="">{{p.time_long}}</td>
                                            <td style="">{{p.headmaster}}</td>
                                            <td style="text-align:center;padding:14px;color:#666">
                                                <button class="btn btn-danger btn-sm" @click="period_del($event)">删除</button>
                                                <button class="btn btn-info btn-sm" onclick="showPeriodEdit(this)">修改</button>
                                                <button class="btn btn-info btn-sm" @click="showPeriodManage(p.id)">学员、排课管理</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab4">
                            <div class="panel-body">
                                <a href="javascript:;" class="btn btn-primary btn-sm" style="margin-bottom:15px;" onclick="addProductRal()">
                                    <i class="fa fa-plus-circle"></i>&nbsp; 关联产品
                                </a>
                                <table class="table select-table table-bordered">
                                    <thead>
                                        <tr style="background-color:#f9fafc;text-align:center;">
                                            <td style="">产品名称</td>
                                            <td style="">产品编号</td>
                                            <td style="">成本价</td>
                                            <td style="">添加人</td>
                                            <td style="">添加时间</td>
                                            <td style="">操作</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="p in products" :data-id="p.id">
                                            <td style=""><a :href="'{:U('product/view')}&id='+p.product_id" target="_blank">{{p.name}}</a></td>
                                            <td style="">{{p.code}}</td>
                                            <td style="">{{p.cost_price}}</td>
                                            <td style="">{{p.creator_name}}</td>
                                            <td style="">{{p.create_at}}</td>
                                            <td style="text-align:center;padding:14px;color:#666">
                                                <button class="btn btn-danger btn-sm" @click="PC_del($event)">取消</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane" id="tab6">
                            <div class="panel-body">
                                <!--<a href="javascript:;" onclick="showSectionCateAdd()" class="btn btn-primary btn-sm addsection" style="margin-bottom:15px;">-->
                                    <!--<i class="fa fa-plus-circle"></i>&nbsp; 添加课程-->
                                <!--</a>-->
                                <table class="table select-table table-bordered">
                                    <thead>
                                    <tr style="background-color:#f9fafc;text-align:center;">
                                        <td style="">课程名称</td>
                                        <td style="">创建人</td>
                                        <td style="">创建时间</td>
                                        <!--<td style="">操作</td>-->
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="s in sections_cate" :data-id="s.id">
                                        <td style="">
                                            <a :href="'/index.php?m=educationview&a=course_manage_detail&id='+s.id">
                                                {{s.name}}
                                            </a>
                                        </td>
                                        <td style="">{{s.create_user}}</td>
                                        <td style="">{{s.create_time}}</td>
                                        <!--<td style="text-align:center;padding:14px;color:#666">-->
                                            <!--<button class="btn btn-danger btn-sm" @click="section_cate_del($event)">取消关联</button>-->
                                        <!--</td>-->
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 弹框模板定义 -->
<div style="display:none" id="dialog-section-add" title="添加课时">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-section-cate-add" title="添加课时">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-section-edit" title="修改课时">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-productral-add" title="产品关联">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-period-add" title="开期(开班次)">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-period-edit" title="班次修改">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<div style="display:none" id="dialog-periodmanage-add" title="班次管理">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<include file="Public:footer" />
<script>
$(function() {
    var templete_Detail = new Vue({
        el: '.templete_Detail',
        data: {
            detail: {},
            sections: {},
            sections_cate: {},
            periods: {},
            products: {},
            count: {},
        },
        methods: {
            getCourseDetail: function () {
                var id = getQueryString('id');
                dd(id)
                if (!id) return;
                var _this = this;
                $.ajax({
                    url: "/index.php?m=education&a=course_detail",
                    data: {id: id},
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result == true) {
                            _this.detail = res.detail
                            // var _first = res.detail.detail.substr(0,4);
                            // var _last = res.detail.detail.substr(res.detail.detail.length-4,res.detail.detail.length);
                            // if (_first == '&lt;' && _last == '&gt;') {
                            //     _this.detail  = res.detail.detail.substr(4,res.detail.detail.length-4);
                            // }
                            // _this.$nextTick(function(){
                            //     var oDiv = document.getElementById("temp_detail");
                            //     oDiv.innerHTML = res.detail.detail;
                            // })
                            // 
                            function escapeStringHTML(str) {
                                str = str.replace(/&lt;/g, '<');
                                str = str.replace(/&gt;/g, '>');
                                str = str.replace(/&amp;/g, '"');
                                str = str.replace(/&quot;/g, '"');
                                str = str.replace(/&#039;/g, "'");
                                return str;
                            }

                            $("#temp_detail").html(escapeStringHTML(res.detail.detail))
                            _this.sections = res.sections;
                            _this.sections_cate = res.sections_cate;
                            _this.periods = res.periods;
                            _this.products = res.products;
                            _this.count = res.count;
                        } else {
                            alert(res.error);
                        }
                    }
                });
            },
            section_del: function (btn) {
                var parent = $(btn.target).parent().parent().parent(),
                    section_id = parent.data('id'),
                    _this = this;
                if (!section_id) return;

                layer.confirm('确定删除课时吗?', {icon: 3, title: '提示'}, function (index) {
                    // 删除
                    $.ajax({
                        url: "/index.php?m=education&a=section_del",
                        data: {id: section_id},
                        dataType: "JSON",
                        type: "POST",
                        success: function (res) {
                            dd(res);
                            if (res.result) {
                                _this.getCourseDetail();
                                layer.msg('删除成功！');
                            } else {
                                alert(res.error);
                            }
                        }
                    });
                    layer.close(index);
                });
            },
            section_cate_del: function (btn) {
                var parent = $(btn.target).parent().parent(),
                    section_id = parent.data('id'),
                    _this = this;
                if (!section_id) return;

                layer.confirm('确定删除课时分类吗?', {icon: 3, title: '提示'}, function (index) {
                    // 删除
                    $.ajax({
                        url: "/index.php?m=education&a=section_cate_del",
                        data: {id: section_id},
                        dataType: "JSON",
                        type: "POST",
                        success: function (res) {
                            dd(res);
                            if (res.result) {
                                _this.getCourseDetail();
                                layer.msg('删除成功！');
                            } else {
                                alert(res.error);
                            }
                        }
                    });
                    layer.close(index);
                });
            },
            period_del: function (btn) {
                var parent = $(btn.target).parent().parent(),
                    period_id = parent.data('id'),
                    _this = this;
                if (!period_id) return;
                layer.confirm('确定删除班次吗?', {icon: 3, title: '提示'}, function (index) {
                    // 删除
                    $.ajax({
                        url: "/index.php?m=education&a=period_del",
                        data: {id: period_id},
                        dataType: "JSON",
                        type: "POST",
                        success: function (res) {
                            dd(res);
                            if (res.result) {
                                _this.getCourseDetail();
                                layer.msg('删除成功！');
                            } else {
                                layer.msg("ERROR " + res.error);
                            }
                        }
                    });
                    layer.close(index);
                });
            },
            PC_del: function (btn) {
                var parent = $(btn.target).parent().parent(),
                    ral_id = parent.data('id'),
                    _this = this;
                if (!ral_id) return;
                layer.confirm('确定删除产品关联吗?', {icon: 3, title: '提示'}, function (index) {
                    // 删除
                    $.ajax({
                        url: "/index.php?m=education&a=courseproduct_del",
                        data: {id: ral_id},
                        dataType: "JSON",
                        type: "POST",
                        success: function (res) {
                            dd(res);
                            if (res.result) {
                                _this.getCourseDetail();
                                layer.msg('删除成功！');
                            } else {
                                layer.msg("ERROR " + res.error);
                            }
                        }
                    });
                    layer.close(index);
                });
            },


            gotoProductDetail: function (product_id) {
                if (!product_id) return;

                window.open('/index.php?m=product&a=view&id=' + product_id);
            }
        },
        mounted: function () {
            $("[type='tab1']").click();
            // 获取详情
            this.getCourseDetail();
        }
    });

    // 添加课时弹框显示
    $("#dialog-section-add").dialog({
        autoOpen: false,
        // modal: true, 影响分类选择插件
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '添加': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                data['course_id'] = course_id;
                $.ajax({
                    url: "{:U('education/section_add')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('添加成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 修改课时弹框显示
    $("#dialog-section-edit").dialog({
        autoOpen: false,
        modal: true,
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '修改': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                $.ajax({
                    url: "{:U('education/section_edit')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('课时修改成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 添加课时弹框显示
    $("#dialog-section-cate-add").dialog({
        autoOpen: false,
        modal: true,
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '添加': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_cate_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                data['course_id'] = course_id;
                $.ajax({
                    url: "{:U('education/section_cate_add')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('添加成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 添加产品关联显示
    $("#dialog-productral-add").dialog({
        autoOpen: false,
        // modal: true,
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '添加': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                data['course_id'] = course_id;
                $.ajax({
                    url: "{:U('education/courseproduct_add')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('关联成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 添加课期（班级）显示
    $("#dialog-period-add").dialog({
        autoOpen: false,
        modal: true,
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '添加': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                data['course_id'] = course_id;
                $.ajax({
                    url: "{:U('education/period_add')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('新增班次成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 编辑课期（班级）显示
    $("#dialog-period-edit").dialog({
        autoOpen: false,
        modal: true,
        width: '55%',
        maxHeight: 600,
        position: ["center", 100],
        buttons: {
            '修改': function () {
                // 操作
                var course_id = templete_Detail.detail.id,
                    form_data = $('#section_add_form').serializeArray(),
                    data = {},
                    _dialog = this;
                form_data.forEach(function (v) {
                    data[v.name] = v.value;
                });
                $.ajax({
                    url: "{:U('education/period_edit')}",
                    data: data,
                    dataType: "JSON",
                    type: "POST",
                    success: function (res) {
                        if (res.result) {
                            // 刷新主页数据
                            templete_Detail.getCourseDetail();
                            //
                            layer.msg('修改班次成功！');
                            // 关闭弹框
                            $(_dialog).dialog('close');

                        } else {
                            layer.msg('ERROR ' + res.error);
                        }
                    }
                });
                return;
            },
            '取消': function () {
                $(this).dialog('close');
            }
        },
        close: function () {
            $(this).html('');
        }
    });
    // 课期操作显示
    $("#dialog-periodmanage-add").dialog({
        autoOpen: false,
        modal: true,
        width: '80%',
        maxHeight: 800,
        position: ["center", 100],
        buttons: {
            '关闭': function () {
                templete_Detail.getCourseDetail();
                $(this).dialog('close');
            }
        },
        close: function () {
            templete_Detail.getCourseDetail();
            $(this).html('');
        }
    });
});
    function dd(data) {
        console.log(data)
    }




function loadFile(that,file,type){
    var pobj            =   $(that),
        data            =   new FormData(),
        schedule_id     =   pobj.attr('data-id');
    if( !schedule_id ){
        layer.msg('ERROR 参数缺失');return ;
    }
    if( !file ){
        layer.msg('ERROR 请选择文件');return ;
    }
    switch (type){
        case 1:
            // 视频
            data.append('video',file);
            break;
        case 2:
            // 作业
            data.append('homework',file);
            break;
        case 3:
            // 课程视频
            data.append('old_video',file);
            break;
    }
    data.append('id',schedule_id);
    $.ajax({
        url:"{:U('education/schedule_upload')}",
        data:data,
        dataType:"JSON",
        type:"POST",
        processData:false,
        contentType:false,
        async:false,
        success:function (res) {
            if( res.result ){
                // 刷新主页数据
                templete_Detail.getCourseDetail()
                //window.location.reload(true);
                //
                layer.msg( '上传成功！' );
                // 关闭弹框

            }else{
                layer.msg('ERROR '+res.error);
            }
        }
    });
}
function showSectionEdit(btn) {
    var id = $(btn).parent().parent().parent().attr('data-id');
    if (!id) {
        layer.msg('主键缺失');
        return;
    }
    $('#dialog-section-edit').dialog('open');
    $('#dialog-section-edit').load('{:U("educationview/section_edit")}&id=' + id);
}

function showSectionAdd() {
    $('#dialog-section-add').dialog('open');
    $('#dialog-section-add').load('{:U("educationview/section_add")}');
}

function showSectionCateAdd() {
    $('#dialog-section-cate-add').dialog('open');
    $('#dialog-section-cate-add').load('{:U("educationview/section_cate_add")}');
}

function addProductRal() {
    $('#dialog-productral-add').dialog('open');
    $('#dialog-productral-add').load('{:U("educationview/courseproduct_add")}');
}

function showPeriodAdd() {
    $('#dialog-period-add').dialog('open');
    $('#dialog-period-add').load('{:U("educationview/period_add")}');
}

function showPeriodEdit(btn) {
    var id = $(btn).parent().parent().data('id');
    console.log(id)
    if (!id) {
        layer.msg('主键缺失');
        return;
    }
    $('#dialog-period-edit').dialog('open');
    $('#dialog-period-edit').load('{:U("educationview/period_edit")}&id=' + id);
}

function showPeriodManage(period_id) {
    if (!period_id) return;
    //$('#dialog-periodmanage-add').dialog('open');
    window.location.href='{:U("educationview/period_detail")}' + '&id=' + period_id;
    //$('#dialog-periodmanage-add').load('{:U("educationview/period_detail")}' + '&id=' + period_id);
}


</script>